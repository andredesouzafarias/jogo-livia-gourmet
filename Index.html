<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8">
			<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
				<title>Livia Gourmet - Desafio Voador</title>
				<style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
    .game-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; position: relative; }
    #game-canvas { background-color: #fdf8f5; border: 2px solid #6d2828; border-radius: 8px; cursor: pointer; }

    /* --- ESTILOS DE AUTENTICA√á√ÉO --- */
    #auth-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fdf8f5; display: flex; justify-content: center; align-items: center; z-index: 200; }
    #auth-box { background: white; padding: 25px 30px; border-radius: 10px; text-align: center; max-width: 90%; width: 340px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    #auth-box h2 { margin-top: 0; color: #d6336c; }
    #auth-box h3 { margin-top: 0; color: #333; }
    #auth-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 1em; }
    #auth-box button { width: 100%; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold; color: white; background-color: #d6336c; transition: background-color 0.2s; margin-bottom: 15px; }
    #auth-box button:hover { background-color: #b02a58; }
    .auth-switch a { color: #d6336c; text-decoration: none; font-weight: bold; }
    #auth-status { font-size: 0.9em; margin-top: 10px; height: 20px; color: #d6336c; }
    #user-info { position: absolute; top: 5px; right: 10px; font-size: 0.8em; z-index: 10; display: flex; align-items: center; }
    #logout-button { background: #6d2828; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-left: 10px; }

    /* --- ESTILOS DO POP-UP E RANKING (Originais) --- */
    .game-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.75); display: none; justify-content: center; align-items: center; z-index: 1000; text-align: center; }
    .popup-content { background: white; padding: 30px; border-radius: 10px; max-width: 90%; width: 350px; }
    .popup-content h2 { margin-top: 0; color: #d6336c; }
    .popup-ranking-tip { font-size: 0.85em; color: #444; margin-top: 15px; background: #f8f9fa; padding: 10px; border-radius: 5px;}
    .popup-buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
    .popup-buttons button, .popup-buttons a { border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold; transition: opacity 0.2s; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; }
    #show-ranking-button { background-color: #007bff; color: white; }
    #close-popup { background-color: #6c757d; color: white; }
    #ranking-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); z-index: 1001; display: none; justify-content: center; align-items: center; }
    #ranking-container { width: 90%; max-width: 600px; background-color: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 20px 30px; text-align: center; }
    #ranking-container h1 { color: #1c1e21; border-bottom: 2px solid #e0e0e0; padding-bottom: 15px; margin-top: 0; }
    #ranking-container ol { list-style-type: none; padding-left: 0; font-size: 1.1em; }
    #ranking-container li { display: flex; justify-content: space-between; padding: 12px 5px; border-bottom: 1px solid #f0f0f0; font-weight: 500; }
    #ranking-container li:last-child { border-bottom: none; }
    .rank-position { font-weight: bold; color: #606770; margin-right: 15px; }
    .rank-nickname { flex-grow: 1; color: #333; text-align: left; }
    .rank-score { font-weight: bold; color: #007bff; }
    #ranking-container #loading, #ranking-container #error { text-align: center; font-size: 1.2em; color: #606770; padding: 40px 0; }
    #close-ranking-button { background-color: #6c757d; color: white; width: 100%; margin-top: 20px; padding: 12px; border-radius: 8px; border: none; cursor: pointer;}
</style>
			</head>
			<body>
				<div id="auth-container">
					<div id="auth-box">
						<h2>Livia Gourmet</h2>
						<div id="auth-forms">
							<form id="login-form">
								<h3>Entrar</h3>
								<input type="email" id="login-email" placeholder="Seu E-mail" required>
								<input type="password" id="login-password" placeholder="Sua Senha" required>
								<button type="submit">Entrar</button>
								<p class="auth-switch">N√£o tem uma conta? <a href="#" id="show-signup">Cadastre-se</a>
								</p>
							</form>
							<form id="signup-form" style="display: none;">
								<h3>Criar Conta</h3>
								<input type="text" id="signup-nickname" placeholder="Seu @ do Instagram" required>
								<input type="email" id="signup-email" placeholder="Seu E-mail" required>
								<input type="password" id="signup-password" placeholder="Crie uma Senha" required>
								<button type="submit">Cadastrar e Jogar</button>
								<p class="auth-switch">J√° tem uma conta? <a href="#" id="show-login">Entrar</a>
								</p>
							</form>
						</div>
						<p id="auth-status"/>
					</div>
				</div>
				<div class="game-wrapper" id="game-container" style="display: none;">
					<div id="user-info">
						<span id="user-email-display"/>
						<button id="logout-button">Sair</button>
					</div>
					<canvas id="game-canvas" width="320" height="480"/>
				</div>
				<div class="game-popup" id="win-popup">
					<div class="popup-content">
						<h2 id="popup-title">Fim de Jogo!</h2>
						<p id="popup-message">Sua pontua√ß√£o final foi: <strong>0</strong> pontos!</p>
						<p class="popup-ranking-tip">
							<strong>Ser√° que voc√™ est√° no topo?</strong> A maior pontua√ß√£o do m√™s ganha um Monster Cookie!</p>
						<div class="popup-buttons">
							<button id="show-ranking-button">üç™ Ver Ranking do M√™s</button>
							<button id="close-popup">Jogar Novamente</button>
						</div>
					</div>
				</div>
				<div id="ranking-overlay">
					<div id="ranking-container">
						<h2>üç™ Ranking do M√™s üç™</h2>
						<div id="loading">Carregando ranking...</div>
						<div id="error" style="display: none;"/>
						<ol id="ranking-list"/>
						<button id="close-ranking-button" class="popup-buttons">Fechar</button>
					</div>
				</div>
				<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"/>
				<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"/>
				<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"/>
				<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- PASSO 1: INICIALIZA√á√ÉO DO FIREBASE ---
        const firebaseConfig = {
  apiKey: "AIzaSyD-nDd-6CHPfEREvJUsCTz2joWQNQz1ksM",
  authDomain: "biscoitinho-74d6e.firebaseapp.com",
  projectId: "biscoitinho-74d6e",
  storageBucket: "biscoitinho-74d6e.firebasestorage.app",
  messagingSenderId: "169200236326",
  appId: "1:169200236326:web:bd973e8757e451e50273e7"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- REFER√äNCIAS AOS ELEMENTOS DO HTML ---
        const authContainer = document.getElementById('auth-container');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const showSignup = document.getElementById('show-signup');
        const showLogin = document.getElementById('show-login');
        const authStatus = document.getElementById('auth-status');
        const logoutButton = document.getElementById('logout-button');
        const userEmailDisplay = document.getElementById('user-email-display');
        const gameContainer = document.getElementById('game-container');
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const winPopup = document.getElementById('win-popup');
        const closePopupButton = document.getElementById('close-popup');
        const popupMessage = document.getElementById('popup-message');
        const rankingOverlay = document.getElementById('ranking-overlay');
        const showRankingButton = document.getElementById('show-ranking-button');
        const closeRankingButton = document.getElementById('close-ranking-button');
        const rankingList = document.getElementById('ranking-list');
        const rankingLoading = document.querySelector('#ranking-container #loading');
        const rankingError = document.querySelector('#ranking-container #error');

        let currentUser = null;

        // --- PASSO 2: L√ìGICA DE AUTENTICA√á√ÉO ---
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                userEmailDisplay.textContent = user.email;
                authContainer.style.display = 'none';
                gameContainer.style.display = 'flex';
                resetGame();
            } else {
                currentUser = null;
                authContainer.style.display = 'flex';
                gameContainer.style.display = 'none';
            }
        });
        showSignup.addEventListener('click', (e) => { e.preventDefault(); loginForm.style.display = 'none'; signupForm.style.display = 'block'; });
        showLogin.addEventListener('click', (e) => { e.preventDefault(); signupForm.style.display = 'none'; loginForm.style.display = 'block'; });
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const nickname = signupForm['signup-nickname'].value;
            const email = signupForm['signup-email'].value;
            const password = signupForm['signup-password'].value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    return db.collection('ranking').doc(user.uid).set({ nickname: nickname, email: user.email, bestScore: 0 });
                })
                .then(() => { signupForm.reset(); })
                .catch(error => { authStatus.textContent = `Erro: ${error.message}`; });
        });
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => { authStatus.textContent = `Erro: ${error.message}`; });
        });
        logoutButton.addEventListener('click', () => { auth.signOut(); });

        // --- PASSO 3: L√ìGICA DO JOGO (C√ìDIGO ORIGINAL ADICIONADO AQUI) ---
        const config = {
            URL_PERSONAGEM: 'https://em-content.zobj.net/thumbs/120/apple/354/cookie_1f36a.png',
            URL_ICONE_BISCOITO: 'https://em-content.zobj.net/thumbs/120/apple/354/cookie_1f36a.png',
            URL_BISCOITO_DOURADO: 'https://em-content.zobj.net/thumbs/120/apple/354/cookie_1f36a.png',
            GRAVIDADE: 0.25, FORCA_PULO: -4.6, VELOCIDADE_INICIAL: -1.5, VELOCIDADE_MAXIMA: -3.5,
            ACELERACAO_POR_PONTO: 0.04, PONTOS_BISCOITO_DOURADO: 5, CANOS_LARGURA: 52, CANOS_ESPACO: 120,
            CANOS_FREQUENCIA: 120, PERSONAGEM_LARGURA: 40, PERSONAGEM_ALTURA: 40, HITBOX_REDUCAO: 6
        };
        let frame = 0, score = 0, gameState = 'start', audioCtx;
        let velocidadeAtual = config.VELOCIDADE_INICIAL;
        const personagemImg = new Image(); personagemImg.src = config.URL_PERSONAGEM;
        const cookieIcon = new Image(); cookieIcon.src = config.URL_ICONE_BISCOITO;
        const biscoitoDouradoImg = new Image(); biscoitoDouradoImg.src = config.URL_BISCOITO_DOURADO;
        const efeitoBonus = { ativo: false, x: 0, y: 0, alpha: 1, texto: '' };

        function openRanking() { rankingOverlay.style.display = 'flex'; fetchRanking(); }
        showRankingButton.addEventListener('click', openRanking);
        closeRankingButton.addEventListener('click', () => { rankingOverlay.style.display = 'none'; });

        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
        function playSound(type) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination); g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            if (type === 'jump') { o.frequency.setValueAtTime(300, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(1e-5, audioCtx.currentTime + 0.2); }
            else if (type === 'score') { o.frequency.setValueAtTime(600, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(1e-5, audioCtx.currentTime + 0.1); }
            else if (type === 'hit') { o.type = 'sawtooth'; o.frequency.setValueAtTime(200, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2); g.gain.exponentialRampToValueAtTime(1e-5, audioCtx.currentTime + 0.2); }
            else if (type === 'bonus') { o.frequency.setValueAtTime(800, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1); g.gain.exponentialRampToValueAtTime(1e-5, audioCtx.currentTime + 0.2); }
            o.start(audioCtx.currentTime); o.stop(audioCtx.currentTime + 0.2);
        }

        const personagem = {
            x: 50, y: 150, width: config.PERSONAGEM_LARGURA, height: config.PERSONAGEM_ALTURA, velocidade: 0,
            draw() { ctx.drawImage(personagemImg, this.x, this.y, this.width, this.height); },
            pular() {
                if (gameState === 'start') gameState = 'playing';
                if (gameState === 'playing') { this.velocidade = config.FORCA_PULO; playSound('jump'); }
            },
            update() {
                if (gameState !== 'playing') return;
                this.velocidade += config.GRAVIDADE; this.y += this.velocidade;
                if (this.y + this.height - config.HITBOX_REDUCAO > canvas.height || this.y + config.HITBOX_REDUCAO < 0) { gameOver(); } } }; const canos={ posicoes: [], width: config.CANOS_LARGURA, draw() { ctx.fillStyle='#6d2828' ; for (const p of this.posicoes) { ctx.fillRect(p.x, 0, this.width, p.y); ctx.fillRect(p.x, p.y + config.CANOS_ESPACO, this.width, canvas.height - (p.y + config.CANOS_ESPACO)); } }, update() { if (gameState !=='playing' ) return; if (frame % config.CANOS_FREQUENCIA===0) { this.posicoes.push({ x: canvas.width, y: Math.floor(Math.random() * (canvas.height - config.CANOS_ESPACO - 100)) + 50, passed: false }); } for (const p of this.posicoes) { p.x +=velocidadeAtual; const p_x=personagem.x + config.HITBOX_REDUCAO, p_y=personagem.y + config.HITBOX_REDUCAO; const p_w=personagem.width - 2 * config.HITBOX_REDUCAO, p_h=personagem.height - 2 * config.HITBOX_REDUCAO; if (p_x
					< p.x + this.width && p_x + p_w> p.x && (p_y < p.y || p_y + p_h> p.y + config.CANOS_ESPACO)) { gameOver(); }
                    if (!p.passed && personagem.x > p.x + this.width) {
                        score++; p.passed = true; playSound('score');
                        if (velocidadeAtual > config.VELOCIDADE_MAXIMA) { velocidadeAtual -= config.ACELERACAO_POR_PONTO; }
                        if (score > 0 && score % 10 === 0) { biscoitoDourado.spawn(); }
                    }
                }
                while (this.posicoes.length > 0 && this.posicoes[0].x + this.width < 0) { this.posicoes.shift(); } } }; const biscoitoDourado={ x: canvas.width, y: canvas.height 2, width: 35, height: 35, ativo: false, draw() { if (this.ativo) ctx.drawImage(biscoitoDouradoImg, this.x, this.y, this.width, this.height); }, update() { if (!this.ativo) return; this.x +=velocidadeAtual; if (personagem.x
							< this.x + this.width && personagem.x + personagem.width> this.x && personagem.y < this.y + this.height && personagem.y + personagem.height> this.y) {
                    this.ativo = false; score += config.PONTOS_BISCOITO_DOURADO; playSound('bonus');
                    efeitoBonus.ativo = true; efeitoBonus.texto = '+' + config.PONTOS_BISCOITO_DOURADO;
                    efeitoBonus.x = this.x + (this.width / 2); efeitoBonus.y = this.y; efeitoBonus.alpha = 1.0;
                }
                if (this.x + this.width < 0) { this.ativo=false; } }, spawn() { if (!this.ativo) { this.ativo=true; this.x=canvas.width; this.y=Math.random() * (canvas.height - 200) + 100; } } }; function desenharTelaInicial() { ctx.fillStyle='#333' ; ctx.textAlign='center' ; ctx.font='24px sans-serif' ; ctx.fillText('Toque para Come√ßar', canvas.width 2, canvas.height 2); } function desenharPontuacao() { const scoreText=`${score}`; ctx.font='bold 30px sans-serif' ; ctx.fillStyle='#333' ; ctx.textAlign='center' ; ctx.fillText(scoreText, canvas.width 2, 40); ctx.drawImage(cookieIcon, canvas.width 2 - ctx.measureText(scoreText).width 2 - 35, 15, 30, 30); } function desenharEfeitoBonus() { if (!efeitoBonus.ativo) return; ctx.font='bold 24px sans-serif' ; ctx.fillStyle=`rgba(212, 175, 55, ${efeitoBonus.alpha})`; ctx.textAlign='center' ; ctx.fillText(efeitoBonus.texto, efeitoBonus.x, efeitoBonus.y); efeitoBonus.y -=1; efeitoBonus.alpha -=0.02; if (efeitoBonus.alpha
									<= 0) { efeitoBonus.ativo=false; } } async function gameOver() {
									<-- TORNAMOS A FUN√á√ÉO"async" PARA USAR"await" if (gameState==='over' ) return; playSound('hit'); gameState='over' ; if (currentUser) { const userRef=db.collection('ranking' ).doc(currentUser.uid); try { const doc=await userRef.get(); if (doc.exists && score> (doc.data().bestScore || 0)) {
                        await userRef.update({ bestScore: score });
                        console.log("Nova pontua√ß√£o m√°xima salva!");
                    }
                } catch (error) { console.error("Erro ao salvar pontua√ß√£o: ", error); }
            }
            popupMessage.innerHTML = `Sua pontua√ß√£o final foi: <strong>${score}</strong> pontos!`;
            winPopup.style.display = 'flex';
        }

        function resetGame() {
            personagem.y = 150; personagem.velocidade = 0; canos.posicoes = [];
            score = 0; frame = 0; gameState = 'start';
            velocidadeAtual = config.VELOCIDADE_INICIAL;
            winPopup.style.display = 'none';
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (gameState !== 'form' && auth.currentUser) {
                canos.update(); canos.draw();
                biscoitoDourado.update(); biscoitoDourado.draw();
                personagem.update(); personagem.draw();
                desenharEfeitoBonus();
            }
            if (gameState === 'start') { desenharTelaInicial(); }
            else if (gameState === 'playing') { desenharPontuacao(); }
            frame++;
            requestAnimationFrame(gameLoop);
        }

        async function fetchRanking() { // <-- TORNAMOS A FUN√á√ÉO"async" rankingLoading.style.display='block' ; rankingError.style.display='none' ; rankingList.innerHTML='' ; try { const querySnapshot=await db.collection('ranking').orderBy('bestScore','desc' ).limit(7).get(); rankingLoading.style.display='none' ; if (querySnapshot.empty) { rankingList.innerHTML='<li>Nenhuma pontua√ß√£o registrada.</li>' ; return; } querySnapshot.forEach((doc, index)=> {
                    const player = doc.data();
                    const listItem = document.createElement('li');
                    let icon = "";
                    if (index === 0) icon = "üëë "; else if (index === 1) icon = "ü•à "; else if (index === 2) icon = "ü•â ";
                    listItem.innerHTML = `<div>
												<span class="rank-position">${index + 1}. ${icon}</span>
												<span class="rank-nickname">${player.nickname}</span>
											</div>
											<span class="rank-score">${player.bestScore}</span>`;
                    rankingList.appendChild(listItem);
                });
            } catch (err) {
                rankingLoading.style.display = 'none'; rankingError.style.display = 'block';
                rankingError.textContent = 'Falha ao carregar o ranking.'; console.error('Erro ao buscar ranking:', err);
            }
        }

        function handleInput() { if (gameState === 'form' || !auth.currentUser) return; initAudio(); personagem.pular(); }
        canvas.addEventListener('click', handleInput);
        canvas.addEventListener('touchstart', e => { e.preventDefault(); handleInput(); }, { passive: false });
        window.addEventListener('keydown', e => { if (e.code === 'Space') handleInput(); });
        closePopupButton.addEventListener('click', resetGame);
        
        gameLoop(); // Inicia o jogo
    });
    </script>
									</body>
								</html>